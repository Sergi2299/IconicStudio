// CAPTCHA aleatorio de 4 dígitos
const captchaCodeEl = document.getElementById("captcha-code");
let currentCaptcha = '';

function generarCaptcha() {
  currentCaptcha = '';
  for (let i = 0; i < 4; i++) {
    currentCaptcha += Math.floor(Math.random() * 10);
  }
  captchaCodeEl.textContent = currentCaptcha;
}

generarCaptcha();

// Validar formulario
document.getElementById("formulario-contacto").addEventListener("submit", function (e) {
  e.preventDefault();
  const captchaInput = document.getElementById("captcha-input").value.trim();

  if (captchaInput !== currentCaptcha) {
    alert("Captcha incorrecto. Por favor, introduce el número correcto.");
    generarCaptcha();
    return;
  }

  const formData = new FormData(this);

  fetch("https://formsubmit.co/ajax/sergifenollar88@gmail.com", {
    method: "POST",
    body: formData,
    headers: {
      'Accept': 'application/json'
    }
  }).then(response => {
    if (response.ok) {
      this.reset();
      generarCaptcha();
      document.getElementById("mensaje-enviado").style.display = "block";
      setTimeout(() => {
        document.getElementById("mensaje-enviado").style.display = "none";
      }, 5000);
    } else {
      alert("Ocurrió un error al enviar el mensaje.");
    }
  }).catch(() => {
    alert("Error al enviar el formulario. Intenta de nuevo.");
  });
});

// Aviso cookies
const cookieModal = document.getElementById('cookie-consent');
const btnAccept = document.getElementById('btn-accept-cookies');
const btnDecline = document.getElementById('btn-decline-cookies');
const btnSettings = document.getElementById('btn-settings-cookies');

function setCookieConsent(value) {
  localStorage.setItem('cookieConsent', value);
  cookieModal.style.display = 'none';
}

window.addEventListener('DOMContentLoaded', () => {
  const consent = localStorage.getItem('cookieConsent');
  if (consent === 'true' || consent === 'false' || consent === 'custom') {
    cookieModal.style.display = 'none';
  }
});

btnAccept.addEventListener('click', () => {
  setCookieConsent('true');
});

btnDecline.addEventListener('click', () => {
  setCookieConsent('false');
});

btnSettings.addEventListener('click', () => {
  alert('Aquí se mostrarían las opciones avanzadas de configuración de cookies.');
  setCookieConsent('custom');
});

